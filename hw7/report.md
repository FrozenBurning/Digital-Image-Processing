# 数图小作业七

2017011552 陈昭熹

## 虹膜分割与换色

通过canny算子进行边缘检测，利用霍夫变换来寻找边缘点图像中的圆，根据设定粗略的圆心位置和圆半径来达到精准的虹膜分割目的。同时考虑到了眼睑与睫毛的遮挡问题。分割后，在HSV空间对虹膜进行换色，为了效果更逼真，不显得突兀，只改变色调和饱和度，不改变亮度。

### 边缘检测

边缘检测使用工具箱中的`edge`函数，采用效果较好的canny算子。由于不同图片的噪声程度、人物面部褶皱、衣物、阴影等情况不同，这些都会影响canny算子检测到的边缘。过多的无关边缘会使得眼部周围边缘点过于杂乱，不利于后面检测圆。因此利用`edge`中的两个参数`Threshold`和`sigma`来控制canny算子检测边缘的灵敏程度和平滑程度。同时对于每一张图片采用不同参数的`imadjust`进行灰度拉伸，尽量将眼部周围明显的梯度变化进一步增强，而平滑掉会产生无关边缘的细节。

### Hough变换

霍夫变换检测圆的基本思路与直线一致，在笛卡尔坐标系下圆的方程为：$$(x-a)^2+(y-b)^2 = r^2$$

如果换成霍夫空间的视角则可以变换成：$$(a-x)^2+(b-y)^2=r^2$$
即给定了所有边缘点$(x,y)$，可以找到其在霍夫空间下对应的一族圆方程，将这些圆的公共点（或者说是公共区域）找到，取其中的最大值即可找到原图中圆的位置。实现过程中使用投票法，检测霍夫空间下一定区域内的经过的圆个数，使得检测更加鲁棒。这样的区域设置在实现过程中变成了可以设置的参数，这样一来就可以根据不同的情况来设置不同的ROI(Region of Interest)，来检测不同完整程度的圆。

值得注意的是，由于需要通过检测不同的圆来将虹膜区域限制出来，因此我采取每只眼睛使用四个mask的方法，分别通过霍夫变换找出瞳孔，虹膜外周，上眼睑和下眼睑四个圆，通过四个mask取交集的方法来获得虹膜区域。

### 虹膜换色

虹膜换色的思想受到上一次作业中给小冯换队服的启发，在HSV空间中调整色调和饱和度，能获得比直接赋值填充RGB空间更加逼真和平滑的效果，能够保留原图中虹膜的纹理和生理特征。

### 效果

#### eye 1

##### 边缘检测
![](eye1_edge.png)
##### 霍夫变换获得虹膜区域
![](eye1_iris.png)
##### 变色效果
![](eye1_blue.png)
![](eye1_purple.png)
![](eye1_red.png)

#### eye 2
##### 边缘检测
![](eye2_edge.png)
##### 霍夫变换获得虹膜区域
![](eye2_iris.png)
##### 变色效果
![](eye2_blue.png)
![](eye2_purple.png)
![](eye2_green.png)
#### eye 3
##### 边缘检测
![](eye3_edge.png)
##### 霍夫变换获得虹膜区域
![](eye3_iris.png)
##### 变色效果
![](eye3_blue.png)
![](eye3_green.png)
![](eye3_purple.png)